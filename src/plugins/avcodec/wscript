from waftools.plugin import plugin

def plugin_configure(conf):
    cfg = conf.create(configurator='cfgtool')
    cfg.binary = 'ffmpeg-config'
    cfg.uselib = 'avcodec'
    cfg.tests = {'--cflags': 'CCFLAGS',
                 '--plugin-libs avcodec': 'LINKFLAGS'}
    if cfg.run():
	return True

    if not conf.check_pkg('libavcodec', destvar='avcodec'):
        return False

    h = conf.create_header_configurator()
    h.name = "avcodec.h"
    h.path = conf.env['CPPPATH_avcodec']

    if h.run():
        return True

    h = conf.create_header_configurator()
    h.name = "libavcodec/avcodec.h"
    h.path = conf.env['CPPPATH_avcodec']
    if h.run():
        return True

    return False

configure, build = plugin('avcodec', configure=plugin_configure,
                          source="avcodec.c",
                          needs_lib=True)
